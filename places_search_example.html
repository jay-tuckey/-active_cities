<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Place Search Pagination</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #right-panel {
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }

      #right-panel select, #right-panel input {
        font-size: 15px;
      }

      #right-panel select {
        width: 100%;
      }

      #right-panel i {
        font-size: 12px;
      }
      #right-panel {
        font-family: Arial, Helvetica, sans-serif;
        position: absolute;
        right: 5px;
        top: 60%;
        margin-top: -195px;
        height: 330px;
        width: 200px;
        padding: 5px;
        z-index: 5;
        border: 1px solid #999;
        background: #fff;
      }
      h2 {
        font-size: 22px;
        margin: 0 0 5px 0;
      }
      ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
        height: 271px;
        width: 200px;
        overflow-y: scroll;
      }
      li {
        background-color: #f1f1f1;
        padding: 10px;
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
      }
      li:nth-child(odd) {
        background-color: #fcfcfc;
      }
      #more {
        width: 100%;
        margin: 5px 0 0 0;
      }
    </style>
    <script>
      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCyVV9-8T7whfe70FRJt8NWxQqSrsVd6q0&libraries=places">

      var map;

      var res;

      var triangleCoords = [
        {lat: -12.455103, lng: 130.839374},
        {lat: -12.461524, lng: 130.843749},
        {lat: -12.460440, lng: 130.836091}
      ];

      var innerTriCoords = [
      {lat: -12.459440, lng: 130.838191},
      {lat: -12.459524, lng: 130.841749},
      {lat: -12.457103, lng: 130.840374}
        
        
      ];

      var realMultiPoly = {"type": "MultiPolygon", "coordinates": [[[[130.861139997051, -12.3770509779408], [130.861086001655, -12.3770489975542], [130.861043994749, -12.3770379884934], [130.86101600213, -12.3770249862384], [130.860980976825, -12.3770039885181], [130.860925965891, -12.3769230332886], [130.860827002879, -12.3767810173582], [130.860769984019, -12.3766950141112], [130.860763612999, -12.3766838514427], [130.860766796984, -12.3766624131601], [130.860769715457, -12.3766355534266], [130.860775211087, -12.3765872586605], [130.860790463756, -12.3765463070968], [130.860861805001, -12.3765136470002], [130.860907369047, -12.3765133350831], [130.86094966926, -12.3765338310809], [130.861036021395, -12.376586647343], [130.861181995698, -12.3766756560826], [130.861314720512, -12.3767566214581], [130.861409438899, -12.3768131774837], [130.861456044966, -12.3768208115523], [130.861476580246, -12.3768192238187], [130.861491499711, -12.3768167733752], [130.861492033049, -12.3768170390784], [130.861559981078, -12.3767979574915], [130.861516971623, -12.3768269908225], [130.861461988404, -12.3768570082143], [130.861380970186, -12.3769150369863], [130.861263039469, -12.3769960040184], [130.861212999327, -12.3770279760526], [130.861177941074, -12.3770450246125], [130.861139997051, -12.3770509779408]]], [[[130.861059003413, -12.3771980194582], [130.861043016576, -12.3771459860053], [130.861018943083, -12.3770869594754], [130.860999980038, -12.377042988196], [130.861058971227, -12.3770649959663], [130.861119000524, -12.3770729901228], [130.861146991356, -12.3770749677796], [130.861122038236, -12.3770950194251], [130.861093997887, -12.3771290092143], [130.861070915409, -12.3771670325071], [130.861059003413, -12.3771980194582]]], [[[130.861064025235, -12.3785915722164], [130.861063036678, -12.3785910366588], [130.860926062959, -12.3785420009398], [130.860896977377, -12.3783000087092], [130.86084700774, -12.3780210200032], [130.860794989238, -12.377838016349], [130.860723997112, -12.377599023485], [130.860649999528, -12.3774600001854], [130.860649693834, -12.377459550339], [130.860756889017, -12.3767300784093], [130.860764918904, -12.3767399624852], [130.860875100946, -12.3769029583841], [130.860937000513, -12.3769929929223], [130.860984995585, -12.3770789675086], [130.861013021342, -12.3771499867523], [130.86103604474, -12.377231975355], [130.861046996705, -12.3773010325689], [130.861053030366, -12.3774249789016], [130.861054982282, -12.3775719957385], [130.86105199539, -12.377707028429], [130.861039003332, -12.3781739648826], [130.861036066702, -12.3783909626768], [130.861039015886, -12.378486010547], [130.861045006446, -12.3785289850741], [130.861051981482, -12.3785610186496], [130.861064025235, -12.3785915722164]]], [[[130.863036982853, -12.3806439879211], [130.863009528571, -12.3805572394618], [130.863024018475, -12.3803340199455], [130.862919025124, -12.3801439701739], [130.862807003287, -12.3799890317094], [130.862700110879, -12.3798520415581], [130.862494993228, -12.3796769554343], [130.862215972631, -12.3795049967631], [130.861969974325, -12.3794030301308], [130.861916745332, -12.3793062460663], [130.861866035837, -12.3791369700263], [130.862161980857, -12.3792900161516], [130.862341900002, -12.3793969557227], [130.862492998255, -12.3794919834279], [130.862613894282, -12.3795939953005], [130.862729995851, -12.3797039922772], [130.862799076685, -12.3797909959897], [130.862983080469, -12.3800140317253], [130.863194031964, -12.3802629982452], [130.863339027003, -12.3804380440223], [130.863348368897, -12.3804509930791], [130.863121218954, -12.3805157179315], [130.863121295631, -12.3805158981811], [130.863121069171, -12.3805159901214], [130.863151023889, -12.3806130229049], [130.863036982853, -12.3806439879211]]], [[[130.863266351559, -12.3809453333226], [130.863245976549, -12.3808840220695], [130.863218113456, -12.3808252008147], [130.86347760927, -12.3807564586639], [130.863477606698, -12.380756096227], [130.86347806118, -12.3807560027228], [130.863417249227, -12.3805736938448], [130.863401210972, -12.3805252755891], [130.863430014816, -12.380567009818], [130.863454018994, -12.3806160052561], [130.863504036867, -12.3807410046351], [130.863502013282, -12.3807550267907], [130.863487023364, -12.3807689543759], [130.863433893146, -12.3808249875644], [130.863350996335, -12.3808960439145], [130.863317108831, -12.3809179638961], [130.863266351559, -12.3809453333226]]], [[[130.863435250638, -12.3815718794746], [130.863435017127, -12.3815709781033], [130.863350965087, -12.3812869816059], [130.863267194084, -12.3809679199425], [130.863327906259, -12.3809329818868], [130.863362041098, -12.3809140411927], [130.86341389925, -12.3808710316559], [130.863472971195, -12.3808080014906], [130.863506001006, -12.3807719887084], [130.86351196815, -12.3807689640919], [130.863533930828, -12.3808509595876], [130.863559003544, -12.3809970050378], [130.863595985397, -12.3812509603535], [130.86356803611, -12.3812870286974], [130.863548004378, -12.3813169876723], [130.863530031712, -12.3813590435667], [130.863493990879, -12.381472974895], [130.863457940756, -12.3815319605356], [130.863435250638, -12.3815718794746]]], [[[130.863796033019, -12.3826019644994], [130.863759966899, -12.3825519672177], [130.863637925717, -12.3822890161306], [130.863543988725, -12.382001020121], [130.863444764446, -12.3816090458097], [130.863460994729, -12.3815989954798], [130.863493103186, -12.3815400341578], [130.863525967328, -12.3814700430697], [130.863557920658, -12.3813679796495], [130.863570037468, -12.3813340075105], [130.863582022644, -12.3813239835777], [130.863603107376, -12.3813250158226], [130.863610042781, -12.3813300281587], [130.863642038182, -12.3815650389547], [130.863680015884, -12.3817990162484], [130.863705994303, -12.3819980108461], [130.863757034105, -12.3823310338617], [130.863796033019, -12.3826019644994]]], [[[130.864742703663, -12.3852684078534], [130.864718346335, -12.3852655940694], [130.864666912723, -12.3852510358843], [130.864639025906, -12.385231978364], [130.864606966933, -12.3851909898157], [130.864576095613, -12.3851039966792], [130.864449203284, -12.384734715074], [130.86473298706, -12.3846049845757], [130.864596000597, -12.3843089717889], [130.864531008964, -12.3842110065522], [130.864480013288, -12.384162014855], [130.864482992172, -12.3841009954429], [130.864505037514, -12.3840449945607], [130.864549060109, -12.383977007497], [130.864492911199, -12.3838750026859], [130.864477970952, -12.3838209738968], [130.86421301596, -12.3839330423546], [130.864157446936, -12.3839445395194], [130.864134962467, -12.3838320048566], [130.864102035757, -12.3837010141834], [130.864069023806, -12.3836219861157], [130.864036032784, -12.38354603198], [130.864014009247, -12.3834660255365], [130.864005999873, -12.3833739935843], [130.863988001135, -12.3832950432693], [130.863939979948, -12.3831309910831], [130.863860981246, -12.3828220195907], [130.86385089705, -12.3827580165941], [130.863813002333, -12.3824930430834], [130.863794988122, -12.3823800257426], [130.863749982399, -12.3820960328022], [130.863734985404, -12.3820019698284], [130.863689992741, -12.3816770392974], [130.863640008615, -12.3813219598236], [130.863627961281, -12.381258965429], [130.863620988734, -12.3812059656424], [130.863587027846, -12.3809930174723], [130.863569999569, -12.3808799933167], [130.863540015441, -12.3807679600732], [130.863477029783, -12.3806000341433], [130.863420019401, -12.3804939701066], [130.863378969339, -12.3804359623913], [130.863230988233, -12.3802569609587], [130.862954968539, -12.3799309954567], [130.862832980377, -12.3797819987025], [130.862755909286, -12.3796909832245], [130.86264298558, -12.3795799684067], [130.862560030869, -12.3795039939232], [130.862476963463, -12.3794440169967], [130.862386016492, -12.3793849970091], [130.862233968577, -12.379295035642], [130.862139970399, -12.3792439896801], [130.861983967215, -12.3791630027315], [130.861899951475, -12.379119027106], [130.861346988858, -12.3788280277177], [130.861266033783, -12.3787880070627], [130.861216012554, -12.3787479553206], [130.861153002557, -12.378682959617], [130.861108993392, -12.3786140384019], [130.861096010106, -12.3785899982878], [130.861079036571, -12.3785379698029], [130.861070008264, -12.3784729659784], [130.86106597713, -12.3784070258653], [130.861068019868, -12.3783100429599], [130.861070037411, -12.3780810344051], [130.861077025807, -12.3776869771567], [130.861078965248, -12.3774579664173], [130.861079025221, -12.3773379545241], [130.861072999503, -12.3772900107115], [130.861070021069, -12.3772440336617], [130.861091044425, -12.3771829800998], [130.861116958177, -12.3771379793683], [130.861135964151, -12.3771129971141], [130.861168110952, -12.377080966832], [130.861192949132, -12.3770659758782], [130.861269027022, -12.3770170179496], [130.861393972721, -12.3769310351648], [130.861540986794, -12.3768349603568], [130.86170503601, -12.3767250316808], [130.861792290925, -12.3766590972822], [130.861847467291, -12.376677877957], [130.861859408614, -12.376800878982], [130.861805063544, -12.3769315632394], [130.861696526162, -12.377203866709], [130.861223548671, -12.3775003544324], [130.861230137204, -12.3779057961289], [130.861112321734, -12.3779174466882], [130.861098566103, -12.378565581508], [130.861165545696, -12.3786664249561], [130.861279673511, -12.3786584141899], [130.861532138822, -12.3784322071235], [130.862625552703, -12.37942031587], [130.862707780402, -12.3795863033891], [130.862815221472, -12.3796833474715], [130.862903595374, -12.3796790340009], [130.862900804581, -12.3797985230596], [130.862996970305, -12.3798557906001], [130.863103487141, -12.3798225271482], [130.863389218714, -12.3801174301619], [130.863416950125, -12.3804032591149], [130.863600618449, -12.3803332290929], [130.863693915947, -12.3805099840722], [130.863849453931, -12.380631999086], [130.863832006381, -12.3807696625292], [130.863608005385, -12.380850813148], [130.863682454866, -12.3814802664839], [130.863737956619, -12.3815233541359], [130.863944508638, -12.381558085182], [130.863728454358, -12.3817441911188], [130.863787594674, -12.3817764081823], [130.863913639858, -12.3818877815314], [130.863755902123, -12.3819793243573], [130.86376412946, -12.3821023505758], [130.863790909599, -12.3822434147351], [130.863973072218, -12.3824737816334], [130.864014664473, -12.3826292007279], [130.864175715799, -12.38300457467], [130.864151406126, -12.3832219898918], [130.86437221656, -12.3837164215883], [130.864512406744, -12.3837589251148], [130.864685494431, -12.3837468933954], [130.864690109784, -12.3838735588948], [130.864613265044, -12.3839428586062], [130.864607584624, -12.384199996939], [130.86468599516, -12.3843297705388], [130.864793285275, -12.3844050364976], [130.864871674013, -12.3845638191569], [130.864879877371, -12.3846832308041], [130.864862968639, -12.3848860437073], [130.864753988605, -12.3851597975139], [130.864825963997, -12.3852055719268], [130.864809651014, -12.3852467135386], [130.864742703663, -12.3852684078534]]]]}

      function convertMultiPoly(multiPoly) {
        var shapes = new Array;
        for(var i = 0;  i < multiPoly.coordinates.length; i++) {
          
          item = multiPoly.coordinates[i];
          coordList = item[0];
          shapeList = new Array;
          for(var ii = 0; ii < coordList.length; ii++) {
            console.log('running in loop 2' );
            shapeList.push({lat: coordList[ii][1], lng: coordList[ii][0]});
          }
          shapes.push(shapeList);
        }
        return shapes;
      }



      var convertedpoly = convertMultiPoly(realMultiPoly);

      function initMap() {
        // Create the map.
        var map_center = {lat: -12.462898, lng:  130.841676,};
        map = new google.maps.Map(document.getElementById('map'), {
          center: map_center,
          zoom: 17,
          styles: [
            {featureType: 'poi', stylers: [ { "visibility": "off" } ]}
          ]
        });

        var poly = new google.maps.Polygon({
          paths: convertMultiPoly(realMultiPoly),
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35
        });
        poly.setMap(map);


        // Create the places service.
        var service = new google.maps.places.PlacesService(map);
        var getNextPage = null;
        var moreButton = document.getElementById('more');
        moreButton.onclick = function() {
          moreButton.disabled = true;
          if (getNextPage) getNextPage();
        };

        // Perform a nearby search.
        service.nearbySearch(
            {location: map_center, radius: 1000, type: ['gym']},
            function(results, status, pagination) {
              if (status !== 'OK') return;

              res = results;

              createMarkers(results);
              moreButton.disabled = !pagination.hasNextPage;
              getNextPage = pagination.hasNextPage && function() {
                pagination.nextPage();
              };
            });
      }

      function createMarkers(places) {
        var bounds = new google.maps.LatLngBounds();
        var placesList = document.getElementById('places');

        for (var i = 0, place; place = places[i]; i++) {
          var image = {
            url: place.icon,
            size: new google.maps.Size(71, 71),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(17, 34),
            scaledSize: new google.maps.Size(25, 25)
          };

          var marker = new google.maps.Marker({
            map: map,
            icon: image,
            title: place.name,
            position: place.geometry.location,
            label: place.name,
            anchorPoint: new google.maps.Point(place.geometry.location)
          });

          
          var li = document.createElement('li');
          li.textContent = place.name;
          placesList.appendChild(li);

          bounds.extend(place.geometry.location);

          var infowindow = new google.maps.InfoWindow({
            content: '<div>This is a little info window</div>'
          });


          marker.addListener('click', function(){
            infowindow.open(map, marker);
          });

        }
        map.fitBounds(bounds);


      }
    </script>
  </head>
  <body>
    <div id="map"></div>
    <div id="right-panel">
      <h2>Results</h2>
      <ul id="places"></ul>
      <button id="more">More results</button>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCyVV9-8T7whfe70FRJt8NWxQqSrsVd6q0&libraries=places&callback=initMap" async defer></script>
  </body>
</html>